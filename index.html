<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oseti 日本語感情分析ツール</title>
    <script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.min.js"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }
        
        h1 {
            color: #667eea;
            margin-top: 0;
            font-size: 2.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        h2 {
            color: #4a5568;
            margin-top: 30px;
            font-size: 1.5em;
        }
        
        h3 {
            color: #4a5568;
            font-size: 1.2em;
        }
        
        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .info-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-left: 4px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-box h3 {
            margin-top: 0;
            color: #667eea;
        }
        
        .info-box p {
            margin-bottom: 10px;
        }
        
        .info-box ul {
            margin: 10px 0;
        }
        
        .success-box {
            background: linear-gradient(135deg, #48bb7815 0%, #38a16915 100%);
            border-left: 4px solid #48bb78;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .success-box h3 {
            margin-top: 0;
            color: #48bb78;
        }
        
        .file-upload {
            border: 3px dashed #cbd5e0;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            background-color: #f8fafc;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            border-color: #667eea;
            background-color: #eef2ff;
            transform: translateY(-2px);
        }
        
        .file-upload.loaded {
            border-color: #48bb78;
            background-color: #f0fff4;
        }
        
        .file-upload-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .lexicon-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            padding: 20px;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
            border: 2px solid #e2e8f0;
            text-align: center;
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 16px;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.6;
        }
        
        .sample-btn {
            background: linear-gradient(135deg, #718096 0%, #4a5568 100%);
            padding: 10px 16px;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .load-sample-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }
        
        .result {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            margin-top: 30px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .sentiment-meter {
            width: 100%;
            height: 32px;
            background: linear-gradient(90deg, #fc8181 0%, #718096 50%, #48bb78 100%);
            border-radius: 16px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .sentiment-indicator {
            position: absolute;
            top: -8px;
            width: 4px;
            height: 48px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: left 0.5s ease;
        }
        
        .sentiment-scale {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 25px;
            font-weight: 500;
        }
        
        .sentiment-label {
            display: inline-block;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-box {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background-color: #f8fafc;
        }
        
        .stat-box p:first-child {
            font-weight: 500;
            margin-bottom: 8px;
            margin-top: 0;
            color: #718096;
            font-size: 14px;
        }
        
        .stat-box p:last-child {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }
        
        .highlight-container {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            background-color: #ffffff;
            margin-top: 20px;
            line-height: 2;
            font-size: 18px;
        }
        
        .highlight-word {
            display: inline-block;
            padding: 3px 8px;
            margin: 0 2px;
            border-radius: 6px;
            font-weight: 600;
            transition: transform 0.2s;
        }
        
        .highlight-word:hover {
            transform: scale(1.1);
        }
        
        .notification {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            background-color: #f0fff4;
            color: #276749;
            border: 2px solid #48bb78;
        }
        
        .notification.error {
            background-color: #fff5f5;
            color: #c53030;
            border: 2px solid #fc8181;
        }
        
        .notification.info {
            background-color: #eef2ff;
            color: #4c51bf;
            border: 2px solid #667eea;
        }
        
        .hidden {
            display: none;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
            color: #718096;
        }
        
        .tab:hover {
            color: #667eea;
            background-color: #eef2ff;
        }
        
        .tab.active {
            border-bottom: 3px solid #667eea;
            color: #667eea;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .word-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            background-color: white;
        }
        
        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.2s;
        }
        
        .word-item:hover {
            background-color: #f8fafc;
        }
        
        .word-item:last-child {
            border-bottom: none;
        }
        
        .score-badge {
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .format-example {
            background-color: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            margin-top: 10px;
            font-size: 14px;
        }
        
        input[type="text"] {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .spinner {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8fafc;
            border-radius: 8px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e0;
            transition: 0.4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #667eea;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .credit-toggle {
            padding: 15px;
            background: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .credit-toggle:hover {
            background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
        }
        
        .credit-content {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            max-height: 0;
        }
        
        .credit-content.show {
            max-height: 2000px;
        }

        .sentence-box {
            background-color: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .feature-section {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .feature-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .feature-examples {
            color: #4a5568;
            font-size: 14px;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>形態素解析器を初期化中...</h3>
            <p>Kuromoji辞書を読み込んでいます</p>
        </div>
    </div>

    <div class="container">
        <h1>
            <span style="font-size: 1.2em;">📊</span>
            Oseti準拠 日本語感情分析ツール / Oseti-based Japanese Sentiment Analyzer
        </h1>
        
        <div id="kuromoji-status" class="hidden"></div>
        
        <div class="info-box">
            <h3>🎯 このツールについて / About This Tool</h3>
            <p>このツールは、日本語テキストの感情極性（ポジティブ/ネガティブ）を分析するWebベースのツールです。<strong>Osetiライブラリ</strong>（池上有希乃氏開発のPython用感情分析ライブラリ）の考え方に準拠し、東北大学の日本語評価極性辞書を使用しています。</p>
            <p style="color: #718096; font-size: 14px;">This is a web-based tool for analyzing sentiment polarity (positive/negative) of Japanese text, based on the <strong>Oseti library</strong> approach (a Python sentiment analysis library developed by Yukino Ikegami) and using the Japanese Sentiment Polarity Dictionary from Tohoku University.</p>
            <p style="margin-top: 15px; margin-bottom: 5px;"><strong>主な機能 / Key Features:</strong></p>
            <ul>
                <li>各単語に<strong>-1.0（最もネガティブ）から+1.0（最もポジティブ）</strong>のスコアを付与<br>
                <span style="color: #718096; font-size: 13px;">Assigns scores from <strong>-1.0 (most negative) to +1.0 (most positive)</strong> to each word</span></li>
                <li>テキスト全体の感情スコアを計算し、総合的な感情を判定<br>
                <span style="color: #718096; font-size: 13px;">Calculates overall sentiment score and determines general sentiment</span></li>
                <li><strong>Kuromoji形態素解析器</strong>（IPAdic辞書使用）による実用的な単語分割<br>
                <span style="color: #718096; font-size: 13px;">Practical word segmentation using <strong>Kuromoji morphological analyzer</strong> (with IPAdic dictionary)</span></li>
                <li><strong>文ごとの分析</strong>に対応し、感情の変化を追跡可能<br>
                <span style="color: #718096; font-size: 13px;">Supports <strong>sentence-by-sentence analysis</strong> to track sentiment changes</span></li>
                <li><strong>✨ 後方否定・並列否定検出</strong>（拡張機能）<br>
                <span style="color: #718096; font-size: 13px;">✨ <strong>Backward & parallel negation detection</strong> (extended feature)</span></li>
                <li>レビュー分析、SNS分析、顧客フィードバック分析などに活用可能<br>
                <span style="color: #718096; font-size: 13px;">Applicable for review analysis, social media analysis, customer feedback analysis, etc.</span></li>
            </ul>
        </div>
        
        <div class="section">
            <h2>1️⃣ 辞書ファイルをロード / Load Dictionary File</h2>
            
            <div style="margin-bottom: 20px;">
                <button id="load-sample-btn" class="load-sample-btn">
                    ✨ サンプル辞書で試す / Try with Sample Dictionary (41語収録 / 41 words)
                </button>
            </div>
            
            <div class="tabs" style="margin-bottom: 0;">
                <div class="tab active" data-load-tab="file">📂 ファイルから / From File</div>
                <div class="tab" data-load-tab="paste">📝 テキストから / From Text</div>
            </div>
            
            <div id="file-upload-tab" class="tab-content" style="display: block;">
                <div id="file-upload" class="file-upload">
                    <div class="file-upload-icon">📄</div>
                    <p style="font-size: 18px; font-weight: 500;">Oseti辞書ファイルをドロップ</p>
                    <p style="font-size: 14px; color: #718096;">Drop Oseti dictionary file here</p>
                    <p style="color: #718096;">または、クリックしてファイルを選択 / Or click to select file</p>
                    <input type="file" id="lexicon-file" accept=".txt,.csv" style="display: none;">
                </div>
            </div>
            
            <div id="paste-upload-tab" class="tab-content" style="display: none; padding: 20px; background-color: #f8fafc; border-radius: 0 0 12px 12px;">
                <p style="margin-top: 0;">辞書の内容を直接貼り付けてください(形式: 単語 TAB スコア)</p>
                <p style="margin-top: 0; font-size: 13px; color: #718096;">Paste dictionary content directly (format: word TAB score)</p>
                <textarea id="paste-input" placeholder="例 / Example:
楽しい	1.0
悲しい	-1.0
嬉しい	1.0
辛い	-1.0
普通	0.0" style="min-height: 200px; font-family: monospace;"></textarea>
                <button id="load-paste-btn">📥 辞書をロード / Load Dictionary</button>
            </div>
            
            <div id="lexicon-stats" class="lexicon-stats hidden"></div>
        </div>
        
        <div id="analysis-section" class="section hidden">
            <h2>2️⃣ テキストを分析 / Analyze Text</h2>
            
            <div class="info-box" style="background: linear-gradient(135deg, #fbbf2415 0%, #f5931815 100%); border-left: 4px solid #fbbf24;">
                <h3 style="color: #fbbf24;">⚠️ 拡張機能について / About Extended Features</h3>
                <p style="font-size: 14px; margin: 10px 0;">
                    本ツールは<strong>元のosetiライブラリ</strong>に加えて、以下の機能を追加実装しています:<br>
                    <span style="color: #718096; font-size: 13px;">This tool implements the following features in addition to the <strong>original oseti library</strong>:</span>
                </p>
                <div class="feature-section">
                    <div class="feature-title">【後方否定 / Backward Negation】</div>
                    <div class="feature-examples">
                        <strong>元のoseti / Original oseti:</strong> 前方否定のみ対応(例:「ない 楽しい」→ 検出) / Forward negation only<br>
                        <strong>本ツール / This tool:</strong> 後方否定も検出可能(下記トグルでON/OFF可能) / Also supports backward negation (toggle below)<br>
                        <strong>対応例 / Examples:</strong> 「楽しくない」「良くない」「お金がない」「希望はない」「期待できない」「満足できない」
                    </div>
                </div>
                <div class="feature-section" style="margin-top: 10px;">
                    <div class="feature-title">【並列否定 / Parallel Negation】</div>
                    <div class="feature-examples">
                        複数の感情語が並列助詞で繋がれた否定表現にも対応しています。<br>
                        <span style="color: #718096; font-size: 13px;">Supports negation patterns with multiple emotion words connected by parallel particles.</span><br>
                        <strong>対応例 / Examples:</strong> 「お金も希望もない」「雰囲気も料理も良くない」「サービスも期待できない」「値段も配送も満足できない」
                    </div>
                </div>
                <p style="font-size: 13px; color: #4a5568; margin: 15px 0 5px 0;">
                    研究で使用する際は、この拡張機能（後方否定・並列否定検出）を使用したことを論文に明記してください。<br>
                    <span style="color: #718096; font-size: 12px;">When using in research, please specify in your paper that these extended features (backward & parallel negation detection) were used.</span>
                </p>
            </div>
            
            <div class="toggle-container">
                <label class="toggle-switch">
                    <input type="checkbox" id="use-kuromoji" checked>
                    <span class="toggle-slider"></span>
                </label>
                <label for="use-kuromoji" style="cursor: pointer; font-weight: 500;">
                    🔬 Kuromoji形態素解析を使用(推奨) / Use Kuromoji Morphological Analyzer (Recommended)
                </label>
            </div>
            
            <div class="toggle-container" style="background: linear-gradient(135deg, #fbbf2410 0%, #f5931810 100%);">
                <label class="toggle-switch">
                    <input type="checkbox" id="backward-negation" checked>
                    <span class="toggle-slider"></span>
                </label>
                <label for="backward-negation" style="cursor: pointer; font-weight: 500;">
                    ✨ 後方否定・並列否定の検出を有効化(拡張機能) / Enable Backward & Parallel Negation Detection (Extended Feature)
                </label>
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="analyze">📝 分析 / Analyze</div>
                <div class="tab" data-tab="words">📚 辞書一覧 / Dictionary</div>
            </div>
            
            <div id="analyze-tab" class="tab-content active">
                <h3>分析するテキストを入力 / Enter text to analyze:</h3>
                <textarea id="text-input" placeholder="分析したい日本語テキストをここに入力してください... / Enter Japanese text here..."></textarea>
                <button id="analyze-btn">🚀 分析開始 / Start Analysis</button>
                
                <div style="margin-top: 20px;">
                    <h3>サンプルテキスト / Sample Text:</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <button class="sample-btn">今日のイベントは最高だった。料理も音楽も素晴らしかった!</button>
                        <button class="sample-btn">このレストランは雰囲気も料理も良くない。サービスも期待できない。</button>
                        <button class="sample-btn">映画は面白かった。でも音楽も演技も良くなかった。</button>
                        <button class="sample-btn">昨日の会議は楽しくなかった。時間も労力も無駄だった。</button>
                        <button class="sample-btn">商品の質は悪くない。しかし値段も配送も満足できない。</button>
                    </div>
                </div>
                
                <div id="result-container" class="result hidden"></div>
            </div>
            
            <div id="words-tab" class="tab-content">
                <h3>辞書に登録されている単語 / Registered Words in Dictionary:</h3>
                <input type="text" id="word-search" placeholder="🔍 単語を検索... / Search words..." style="width: 100%; margin-bottom: 15px;">
                <div id="word-list" class="word-list"></div>
            </div>
        </div>
        
        <div class="section">
            <h2>📖 クレジット・引用情報 / Credits & Citations</h2>
            
            <div style="background-color: #f8fafc; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; margin-bottom: 20px;">
                <p style="margin: 10px 0;"><strong>© 2025 Nozomi Sawada</strong></p>
                <p style="margin: 10px 0; font-size: 14px;">
                    このツールは<strong>東北大学の日本語評価極性辞書(小林ら, 2005; 東山ら, 2008)</strong>および<strong>Kuromoji形態素解析器(Apache License 2.0)</strong>を使用しています。
                </p>
                <p style="margin: 10px 0; font-size: 14px; color: #718096;">
                    This tool uses the <strong>Japanese Sentiment Polarity Dictionary (Tohoku University)</strong> and <strong>Kuromoji morphological analyzer (Apache License 2.0)</strong>.
                </p>
                <p style="margin: 10px 0; font-size: 13px; color: #4a5568;">
                    詳細な引用情報は下記をご確認ください。<br>
                    <span style="color: #718096;">For detailed citation information, please see below.</span>
                </p>
            </div>
            
            <div class="credit-toggle" onclick="toggleCredits()">
                <h3 style="margin: 0; cursor: pointer; display: flex; align-items: center; justify-content: space-between;">
                    <span>📚 詳細な引用情報・ライセンス / Detailed Citations & License</span>
                    <span id="credit-arrow" style="transition: transform 0.3s;">▼</span>
                </h3>
            </div>
            <div id="credit-content" class="credit-content hidden">
                <div style="padding: 20px; background-color: #f8fafc; border-radius: 8px; margin-top: 10px;">
                    <h4 style="color: #667eea; margin-top: 0;">ツール開発 / Tool Development</h4>
                    <p style="margin: 10px 0; font-size: 14px;">
                        開発者 / Developer: Nozomi Sawada (2025)
                    </p>
                    <div style="background-color: white; padding: 15px; border-radius: 6px; border-left: 4px solid #667eea; margin: 15px 0;">
                        <p style="margin: 5px 0; font-size: 14px;">
                            このツールは研究・教育目的で開発されました。<br>
                            使用する場合は、本ツールと使用している辞書(下記)の両方を適切に引用してください。
                        </p>
                        <p style="margin: 10px 0; font-size: 13px; color: #718096;">
                            This tool was developed for research and educational purposes.<br>
                            When using it, please cite both this tool and the dictionaries used (see below).
                        </p>
                    </div>
                    <div style="background-color: white; padding: 15px; border-radius: 6px; border-left: 4px solid #48bb78; margin: 15px 0;">
                        <p style="margin: 5px 0; font-size: 14px;"><strong>📄 論文での引用例 / Citation Examples in Papers:</strong></p>
                        <p style="margin: 10px 0; font-size: 13px; color: #4a5568;">
                            <strong>日本語 / Japanese:</strong><br>
                            「感情分析には、Sawada (2025) が開発したOseti準拠日本語感情分析ツールを使用し、
                            東北大学の日本語評価極性辞書 (小林ら, 2005; 東山ら, 2008) およびKuromoji形態素解析器を用いた。
                            <span style="color: #fbbf24;">後方否定・並列否定検出の拡張機能を有効化して分析を行った。</span>」
                        </p>
                        <p style="margin: 10px 0; font-size: 13px; color: #4a5568;">
                            <strong>English:</strong><br>
                            "For sentiment analysis, we used the Oseti-based Japanese Sentiment Analysis Tool developed by Sawada (2025), 
                            employing the Japanese Sentiment Polarity Dictionary from Tohoku University (Kobayashi et al., 2005; Higashiyama et al., 2008) 
                            and the Kuromoji morphological analyzer. 
                            <span style="color: #fbbf24;">The extended features for backward and parallel negation detection were enabled.</span>"
                        </p>
                    </div>
                    <div style="background-color: white; padding: 15px; border-radius: 6px; border-left: 4px solid #667eea; margin: 15px 0;">
                        <p style="margin: 5px 0; font-size: 14px;"><strong>📚 参考文献リスト / References:</strong></p>
                        <p style="margin: 10px 0; font-size: 12px; color: #4a5568; font-family: monospace; line-height: 1.8;">
                            <strong>このツール / This Tool:</strong><br>
                            Sawada, N. (2025). Oseti-based Japanese Sentiment Analysis Tool [Web application]. GitHub. https://github.com/nozomi-sawada/oseti-sentiment-analyzer
                        </p>
                        <p style="margin: 10px 0; font-size: 12px; color: #4a5568; font-family: monospace; line-height: 1.8;">
                            <strong>辞書 / Dictionary:</strong><br>
                            小林のぞみ, 乾健太郎, 松本裕治, 立石健二, 福島俊一 (2005). 意見抽出のための評価表現の収集. 自然言語処理, 12(3), 203-222.<br>
                            Kobayashi, N., Inui, K., Matsumoto, Y., Tateishi, K., & Fukushima, S. (2005). Collecting Evaluative Expressions for Opinion Extraction. Journal of Natural Language Processing, 12(3), 203-222.
                        </p>
                        <p style="margin: 10px 0; font-size: 12px; color: #4a5568; font-family: monospace; line-height: 1.8;">
                            東山昌彦, 乾健太郎, 松本裕治 (2008). 述語の選択選好性に着目した名詞評価極性の獲得. 言語処理学会第14回年次大会論文集, 584-587.<br>
                            Higashiyama, M., Inui, K., & Matsumoto, Y. (2008). Learning Sentiment of Nouns from Selectional Preferences of Verbs and Adjectives. Proceedings of the 14th Annual Meeting of the Association for Natural Language Processing, 584-587.
                        </p>
                    </div>
                    
                    <h4 style="color: #667eea; margin-top: 25px;">日本語評価極性辞書 / Japanese Sentiment Polarity Dictionary</h4>
                    <p style="margin: 10px 0;">このツールは、東北大学 乾・岡崎研究室が公開している日本語評価極性辞書を使用しています。</p>
                    <p style="margin: 10px 0; font-size: 13px; color: #718096;">This tool uses the Japanese Sentiment Polarity Dictionary published by Tohoku University.</p>
                    <div style="background-color: white; padding: 15px; border-radius: 6px; border-left: 4px solid #667eea; margin: 15px 0;">
                        <p style="margin: 5px 0; font-size: 14px;"><strong>引用文献 / References:</strong></p>
                        <p style="margin: 10px 0 5px 0; font-size: 13px; line-height: 1.8;">
                            <strong>[1]</strong> 小林のぞみ, 乾健太郎, 松本裕治, 立石健二, 福島俊一. 意見抽出のための評価表現の収集. 自然言語処理, Vol.12, No.3, pp.203-222, 2005.<br>
                            <span style="color: #718096; font-size: 12px;">Kobayashi, N., Inui, K., Matsumoto, Y., Tateishi, K., & Fukushima, S. (2005). Collecting Evaluative Expressions for Opinion Extraction. Journal of Natural Language Processing, 12(3), 203-222.</span>
                        </p>
                        <p style="margin: 10px 0 5px 0; font-size: 13px; line-height: 1.8;">
                            <strong>[2]</strong> 東山昌彦, 乾健太郎, 松本裕治. 述語の選択選好性に着目した名詞評価極性の獲得. 言語処理学会第14回年次大会論文集, pp.584-587, 2008.<br>
                            <span style="color: #718096; font-size: 12px;">Higashiyama, M., Inui, K., & Matsumoto, Y. (2008). Learning Sentiment of Nouns from Selectional Preferences of Verbs and Adjectives. Proceedings of the 14th Annual Meeting of the Association for Natural Language Processing, 584-587.</span>
                        </p>
                    </div>
                    <p style="margin: 10px 0; font-size: 14px;">
                        <strong>出典 / Source:</strong> 
                        <a href="http://www.cl.ecei.tohoku.ac.jp/Open_Resources-Japanese_Sentiment_Polarity_Dictionary.html" target="_blank" style="color: #667eea;">
                            東北大学 乾・岡崎研究室 / Tohoku University Inui-Okazaki Lab
                        </a>
                    </p>
                    
                    <h4 style="color: #667eea; margin-top: 25px;">形態素解析器 / Morphological Analyzer</h4>
                    <p style="margin: 10px 0;">形態素解析には、Kuromoji.js(Apache License 2.0)を使用しています。</p>
                    <p style="margin: 10px 0; font-size: 13px; color: #718096;">This tool uses Kuromoji.js (Apache License 2.0) for morphological analysis.</p>
                    <p style="margin: 10px 0; font-size: 14px;">
                        <strong>開発 / Developer:</strong> Atilika (Apache Software Foundation)
                    </p>
                    <p style="margin: 10px 0; font-size: 14px;">
                        <strong>リポジトリ / Repository:</strong> 
                        <a href="https://github.com/takuyaa/kuromoji.js" target="_blank" style="color: #667eea;">
                            kuromoji.js on GitHub
                        </a>
                    </p>
                    
                    <h4 style="color: #667eea; margin-top: 25px;">Osetiライブラリ / Oseti Library</h4>
                    <p style="margin: 10px 0;">感情分析アルゴリズムの実装は、池上有希乃氏のosetiライブラリを参考にしています。</p>
                    <p style="margin: 10px 0; font-size: 13px; color: #718096;">The sentiment analysis algorithm implementation is based on the oseti library by Yukino Ikegami.</p>
                    <p style="margin: 10px 0; font-size: 14px;">
                        <strong>リポジトリ / Repository:</strong> 
                        <a href="https://github.com/ikegami-yukino/oseti" target="_blank" style="color: #667eea;">
                            oseti on GitHub
                        </a>
                    </p>
                    <div style="background-color: white; padding: 15px; border-radius: 6px; border-left: 4px solid #fbbf24; margin: 15px 0;">
                        <p style="margin: 5px 0; font-size: 14px;"><strong>⚠️ 拡張機能について / About Extended Features</strong></p>
                        <p style="margin: 10px 0; font-size: 13px;">
                            本ツールの<strong>「後方否定・並列否定検出」機能</strong>は、元のosetiライブラリには含まれない独自の拡張機能です。
                        </p>
                        <div class="feature-section" style="margin: 10px 0;">
                            <div class="feature-title">【後方否定】</div>
                            <div class="feature-examples" style="font-size: 13px;">
                                元のosetiは前方否定(「ない 楽しい」)のみ対応していますが、本ツールでは後方否定にも対応しています。<br>
                                <strong>対応例:</strong> 「楽しくない」「良くない」「お金がない」「希望はない」「期待できない」「満足できない」
                            </div>
                        </div>
                        <div class="feature-section" style="margin: 10px 0;">
                            <div class="feature-title">【並列否定】</div>
                            <div class="feature-examples" style="font-size: 13px;">
                                複数の感情語が並列助詞で繋がれた否定表現にも対応しています。<br>
                                <strong>対応例:</strong> 「お金も希望もない」「雰囲気も料理も良くない」「サービスも期待できない」「値段も配送も満足できない」
                            </div>
                        </div>
                        <p style="margin: 10px 0; font-size: 13px;">
                            研究で使用する際は、この拡張機能（後方否定・並列否定検出）を使用したことを必ず明記してください。
                        </p>
                        <p style="margin: 10px 0; font-size: 12px; color: #718096;">
                            The <strong>"backward & parallel negation detection"</strong> features are original extensions not included in the original oseti library.<br>
                            The original oseti only supports forward negation, but this tool also supports backward negation (e.g., "not fun", "not good", "cannot expect", "cannot satisfy") and parallel negation (e.g., "no money or hope", "neither atmosphere nor food is good", "neither service nor expectation can be met").<br>
                            When using in research, please specify that these extended features were used.
                        </p>
                    </div>
                    
                    <h4 style="color: #667eea; margin-top: 25px;">📂 辞書ファイルの準備方法 / How to Prepare Dictionary Files</h4>
                    <p style="margin: 10px 0;">
                        このツールを使用するには、日本語評価極性辞書から変換した辞書ファイルが必要です。
                    </p>
                    <p style="margin: 10px 0; font-size: 13px; color: #718096;">
                        To use this tool, you need a dictionary file converted from the Japanese Sentiment Polarity Dictionary.
                    </p>
                    <div style="background-color: white; padding: 15px; border-radius: 6px; border-left: 4px solid #fbbf24; margin: 15px 0;">
                        <p style="margin: 5px 0; font-size: 14px;"><strong>⚠️ 重要 / Important: 辞書ファイルはご自身で準備してください / Please prepare the dictionary file yourself</strong></p>
                        <p style="margin: 10px 0; font-size: 13px;">
                            ライセンスの都合上、辞書ファイル本体は配布していません。<br>
                            以下の手順で辞書ファイルを作成してください:
                        </p>
                        <p style="margin: 10px 0; font-size: 12px; color: #718096;">
                            Due to license restrictions, the dictionary file itself is not distributed.<br>
                            Please create the dictionary file following these steps:
                        </p>
                    </div>
                    <p style="margin: 10px 0; font-size: 13px; color: #4a5568;">
                        <strong>【手順 / Steps】</strong><br>
                        1. 東北大学のサイトから元の辞書ファイルをダウンロード / Download the original dictionary files from Tohoku University<br>
                        　 <a href="http://www.cl.ecei.tohoku.ac.jp/Open_Resources-Japanese_Sentiment_Polarity_Dictionary.html" 
                            target="_blank" style="color: #667eea;">日本語評価極性辞書 / Japanese Sentiment Polarity Dictionary</a><br>
                        　 (<code>pn.csv.m3.120408.trim</code> と / and <code>wago.121808.pn</code>)<br><br>
                        2. 変換方法の詳細は、GitHubリポジトリのREADMEをご覧ください / For conversion details, see the README in the GitHub repository<br><br>
                        3. 生成された <code>japanese_sentiment_dictionary.txt</code> を本ツールで使用 / Use the generated file with this tool
                    </p>
                    <p style="margin: 10px 0; font-size: 13px; color: #4a5568;">
                        <strong>または / Or:</strong><br>
                        本ツールの「📝 テキストから」タブで、Oseti形式(単語 TAB スコア)の独自辞書を直接貼り付けて使用することもできます。<br>
                        <span style="color: #718096;">You can also paste your own dictionary in Oseti format (word TAB score) directly in the "From Text" tab.</span>
                    </p>
                    
                    <div style="background-color: #eef2ff; padding: 15px; border-radius: 6px; margin-top: 20px;">
                        <p style="margin: 0; font-size: 13px; color: #4a5568; line-height: 1.8;">
                            <strong>論文等で引用する場合 / When citing in papers:</strong><br>
                            本ツールを学術研究で使用される場合は、以下を引用してください：<br>
                            • 本ツール (Sawada, 2025)<br>
                            • 日本語評価極性辞書の両文献 (小林ら, 2005; 東山ら, 2008 / Kobayashi et al., 2005; Higashiyama et al., 2008)<br>
                            • 拡張機能（後方否定・並列否定検出）を使用したことを明記<br>
                            <span style="color: #718096; font-size: 12px; display: block; margin-top: 8px;">
                            When using this tool for academic research, please cite:<br>
                            • This tool (Sawada, 2025)<br>
                            • Both papers of the Japanese Sentiment Polarity Dictionary (Kobayashi et al., 2005; Higashiyama et al., 2008)<br>
                            • Specify that the extended features (backward & parallel negation detection) were used
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let lexicon = {};
        let lexiconStats = { totalWords: 0 };
        let tokenizer = null;
        let tokenizerReady = false;
        
        const NEGATION_WORDS = [
            'ない', 'ぬ', 'ん', 'ず', 'まい', 'ねえ', 'なかった', 'なく',
            'なければ', 'ざる', 'ませんでした', 'ません', 'ないで', 'ず',
            'できない', 'できぬ', 'できません', 'られない', 'られぬ'
        ];
        
        const NEGATION_PARTICLES = ['は', 'くは', 'では', 'じゃ', 'が', 'は', 'も'];
        
        const PARALLEL_PARTICLES = ['も', 'と', 'や', 'とか', 'だの'];
        
        const SAMPLE_DICTIONARY = `楽しい	1.0
嬉しい	1.0
幸せ	1.0
好き	1.0
素晴らしい	1.0
美しい	1.0
良い	1.0
最高	1.0
素敵	1.0
感動	1.0
充実	1.0
頑張る	1.0
美味しい	1.0
面白い	1.0
満足	1.0
雰囲気	0.5
料理	0.5
サービス	0.5
期待	0.5
音楽	0.5
演技	0.5
質	0.5
時間	0.0
労力	0.0
値段	0.0
配送	0.0
悲しい	-1.0
苦しい	-1.0
辛い	-1.0
嫌い	-1.0
最悪	-1.0
失敗	-1.0
不幸	-1.0
残念	-1.0
困る	-1.0
疲れる	-1.0
悪い	-1.0
遅刻	-1.0
無駄	-1.0
希望	1.0
お金	1.0`;
        
        let kuromojiLoaded = false;
        
        setTimeout(function() {
            if (!kuromojiLoaded) {
                console.warn('Kuromoji loading timeout');
                var overlay = document.getElementById('loading-overlay');
                if (overlay) overlay.remove();
                
                showNotification('形態素解析器の読み込みに時間がかかっています。簡易トークナイザーで開始します。', 'info');
                tokenizerReady = false;
                
                var statusBox = document.getElementById('kuromoji-status');
                statusBox.className = 'notification info';
                statusBox.innerHTML = '<strong>ℹ️ 簡易トークナイザーモード</strong><br>Kuromoji形態素解析器の読み込みに時間がかかっています。簡易トークナイザーで動作します。';
                statusBox.classList.remove('hidden');
            }
        }, 10000);
        
        kuromoji.builder({ dicPath: "https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict" }).build(function(err, _tokenizer) {
            kuromojiLoaded = true;
            var overlay = document.getElementById('loading-overlay');
            if (overlay) overlay.remove();
            
            if (err) {
                console.error('Kuromoji initialization error:', err);
                showNotification('形態素解析器の初期化に失敗しました。簡易トークナイザーを使用します。', 'error');
                tokenizerReady = false;
            } else {
                tokenizer = _tokenizer;
                tokenizerReady = true;
                
                var statusBox = document.getElementById('kuromoji-status');
                statusBox.className = 'success-box';
                statusBox.innerHTML = '<h3>✅ Kuromoji形態素解析器が準備完了 / Kuromoji Morphological Analyzer Ready</h3><p>Kuromoji形態素解析器（IPAdic辞書使用）による実用的な単語分割・解析が利用可能です。<br><span style="color: #718096; font-size: 14px;">Practical word segmentation and analysis using Kuromoji morphological analyzer (with IPAdic dictionary).</span></p>';
                statusBox.classList.remove('hidden');
            }
        });
        
        var fileUploadElement = document.getElementById('file-upload');
        var lexiconFileInput = document.getElementById('lexicon-file');
        var lexiconStatsElement = document.getElementById('lexicon-stats');
        var analysisSection = document.getElementById('analysis-section');
        var textInput = document.getElementById('text-input');
        var analyzeBtn = document.getElementById('analyze-btn');
        var resultContainer = document.getElementById('result-container');
        var wordSearch = document.getElementById('word-search');
        var wordList = document.getElementById('word-list');
        var loadSampleBtn = document.getElementById('load-sample-btn');
        var pasteInput = document.getElementById('paste-input');
        var loadPasteBtn = document.getElementById('load-paste-btn');
        var useKuromojiToggle = document.getElementById('use-kuromoji');
        var backwardNegationToggle = document.getElementById('backward-negation');
        
        loadSampleBtn.addEventListener('click', function() {
            parseLexiconFile(SAMPLE_DICTIONARY);
            showNotification('サンプル辞書をロードしました!試しに分析してみてください。 / Sample dictionary loaded! Try analyzing some text.', 'success');
        });
        
        document.querySelectorAll('[data-load-tab]').forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelectorAll('[data-load-tab]').forEach(function(t) {
                    t.classList.remove('active');
                });
                tab.classList.add('active');
                
                var tabName = tab.dataset.loadTab;
                document.getElementById('file-upload-tab').style.display = tabName === 'file' ? 'block' : 'none';
                document.getElementById('paste-upload-tab').style.display = tabName === 'paste' ? 'block' : 'none';
            });
        });
        
        loadPasteBtn.addEventListener('click', function() {
            var pastedText = pasteInput.value.trim();
            if (!pastedText) {
                showNotification('辞書データを貼り付けてください。', 'error');
                return;
            }
            parseLexiconFile(pastedText);
        });
        
        fileUploadElement.addEventListener('click', function() {
            lexiconFileInput.click();
        });
        
        fileUploadElement.addEventListener('dragover', function(e) {
            e.preventDefault();
            fileUploadElement.style.borderColor = '#667eea';
        });
        
        fileUploadElement.addEventListener('dragleave', function() {
            fileUploadElement.style.borderColor = '#cbd5e0';
        });
        
        fileUploadElement.addEventListener('drop', function(e) {
            e.preventDefault();
            fileUploadElement.style.borderColor = '#cbd5e0';
            if (e.dataTransfer.files.length > 0) {
                handleLexiconFile(e.dataTransfer.files[0]);
            }
        });
        
        lexiconFileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                handleLexiconFile(e.target.files[0]);
            }
        });
        
        function handleLexiconFile(file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                parseLexiconFile(e.target.result);
            };
            reader.readAsText(file, 'UTF-8');
        }
        
        function parseLexiconFile(fileContent) {
            var lines = fileContent.split('\n');
            lexicon = {};
            var errorCount = 0;
            
            for (var i = 0; i < lines.length; i++) {
                var trimmed = lines[i].trim();
                if (trimmed === '') continue;
                
                var parts = trimmed.split('\t');
                if (parts.length < 2) {
                    errorCount++;
                    continue;
                }
                
                var word = parts[0].trim();
                var score = parseFloat(parts[1].trim());
                
                if (!isNaN(score)) {
                    lexicon[word] = { score: score };
                } else {
                    errorCount++;
                }
            }
            
            lexiconStats.totalWords = Object.keys(lexicon).length;
            
            if (lexiconStats.totalWords === 0) {
                showNotification('エラー: 有効な辞書エントリが見つかりませんでした。ファイル形式を確認してください。', 'error');
                return;
            }
            
            fileUploadElement.classList.add('loaded');
            fileUploadElement.innerHTML = '<div class="file-upload-icon">✅</div><p style="font-size: 18px; font-weight: 600; color: #48bb78;">辞書ロード完了!</p><p style="font-size: 14px; color: #48bb78;">Dictionary Loaded!</p><p style="color: #718096;">' + lexiconStats.totalWords.toLocaleString() + ' 単語を読み込みました<br><span style="font-size: 13px;">' + lexiconStats.totalWords.toLocaleString() + ' words loaded</span></p>';
            
            displayLexiconStats();
            analysisSection.classList.remove('hidden');
            displayWordList();
            
            var msg = '✨ ' + lexiconStats.totalWords.toLocaleString() + ' 単語をロードしました! / ' + lexiconStats.totalWords.toLocaleString() + ' words loaded!';
            if (errorCount > 0) {
                msg += ' (' + errorCount + '行をスキップ / ' + errorCount + ' lines skipped)';
            }
            showNotification(msg, 'success');
        }
        
        function displayLexiconStats() {
            lexiconStatsElement.classList.remove('hidden');
            
            var positiveCount = 0;
            var negativeCount = 0;
            var neutralCount = 0;
            
            for (var word in lexicon) {
                var score = lexicon[word].score;
                if (score > 0) positiveCount++;
                else if (score < 0) negativeCount++;
                else neutralCount++;
            }
            
            lexiconStatsElement.innerHTML = '<div class="stat-card"><h3>総単語数<br><span style="font-size: 11px; font-weight: normal; color: #a0aec0;">Total Words</span></h3><div class="stat-value">' + lexiconStats.totalWords.toLocaleString() + '</div></div><div class="stat-card"><h3>ポジティブ<br><span style="font-size: 11px; font-weight: normal; color: #a0aec0;">Positive</span></h3><div class="stat-value" style="color: #48bb78;">' + positiveCount.toLocaleString() + '</div></div><div class="stat-card"><h3>ネガティブ<br><span style="font-size: 11px; font-weight: normal; color: #a0aec0;">Negative</span></h3><div class="stat-value" style="color: #fc8181;">' + negativeCount.toLocaleString() + '</div></div><div class="stat-card"><h3>中立<br><span style="font-size: 11px; font-weight: normal; color: #a0aec0;">Neutral</span></h3><div class="stat-value" style="color: #718096;">' + neutralCount.toLocaleString() + '</div></div>';
        }
        
        function displayWordList(searchTerm) {
            if (typeof searchTerm === 'undefined') searchTerm = '';
            
            var words = Object.keys(lexicon).filter(function(word) {
                return searchTerm === '' || word.includes(searchTerm);
            }).sort();
            
            var html = '';
            var maxDisplay = 500;
            var displayWords = words.slice(0, maxDisplay);
            
            for (var i = 0; i < displayWords.length; i++) {
                var word = displayWords[i];
                var score = lexicon[word].score;
                var color = score > 0 ? '#48bb78' : (score < 0 ? '#fc8181' : '#718096');
                html += '<div class="word-item"><span><strong>' + word + '</strong></span><span class="score-badge" style="background-color: ' + color + ';">' + (score > 0 ? '+' : '') + score.toFixed(2) + '</span></div>';
            }
            
            if (words.length > maxDisplay) {
                html += '<div class="word-item" style="color: #718096; justify-content: center;">他 ' + (words.length - maxDisplay) + ' 単語...</div>';
            }
            
            wordList.innerHTML = html || '<div class="word-item" style="justify-content: center; color: #718096;">該当する単語が見つかりません</div>';
        }
        
        wordSearch.addEventListener('input', function(e) {
            displayWordList(e.target.value.trim());
        });
        
        analyzeBtn.addEventListener('click', function() {
            var text = textInput.value.trim();
            if (!text) {
                showNotification('分析するテキストを入力してください。', 'error');
                return;
            }
            
            if (Object.keys(lexicon).length === 0) {
                showNotification('まず辞書ファイルをロードしてください。', 'error');
                return;
            }
            
            var result = analyzeText(text);
            displayResult(result, text);
        });
        
        function splitIntoSentences(text) {
            var sentences = text.split(/([。!?!?]+)/).filter(function(s) {
                return s.trim() !== '';
            });
            var result = [];
            
            for (var i = 0; i < sentences.length; i++) {
                if (/[。!?!?]+/.test(sentences[i])) {
                    if (result.length > 0) {
                        result[result.length - 1] += sentences[i];
                    }
                } else {
                    result.push(sentences[i]);
                }
            }
            
            return result.filter(function(s) {
                return s.trim() !== '';
            });
        }
        
        function tokenizeWithKuromoji(text) {
            if (!tokenizer) return tokenizeSimple(text);
            
            var tokens = tokenizer.tokenize(text);
            return tokens.map(function(token) {
                return {
                    word: token.basic_form || token.surface_form,
                    surface: token.surface_form
                };
            });
        }
        
        function tokenizeSimple(text) {
            var tokens = [];
            
            function getCharType(char) {
                if (/[\u3040-\u309F]/.test(char)) return 'hiragana';
                if (/[\u30A0-\u30FF]/.test(char)) return 'katakana';
                if (/[\u4E00-\u9FAF]/.test(char)) return 'kanji';
                if (/[a-zA-Z0-9]/.test(char)) return 'alphanumeric';
                return 'other';
            }
            
            var currentToken = '';
            var currentType = null;
            
            for (var i = 0; i < text.length; i++) {
                var char = text[i];
                var charType = getCharType(char);
                
                if (charType === 'other') {
                    if (currentToken) {
                        tokens.push({ word: currentToken, surface: currentToken });
                        currentToken = '';
                        currentType = null;
                    }
                    continue;
                }
                
                if (currentType === null || (currentType !== charType && !(currentType === 'kanji' && charType === 'hiragana'))) {
                    if (currentToken) {
                        tokens.push({ word: currentToken, surface: currentToken });
                    }
                    currentToken = char;
                    currentType = charType;
                } else {
                    currentToken += char;
                }
            }
            
            if (currentToken) {
                tokens.push({ word: currentToken, surface: currentToken });
            }
            
            return tokens;
        }
        
        function analyzeSingleSentence(text, useKuromoji, useBackwardNegation) {
            var tokens = useKuromoji ? tokenizeWithKuromoji(text) : tokenizeSimple(text);
            
            var emotionWordIndices = [];
            var matchedWords = [];
            var totalScore = 0;
            var matchCount = 0;
            var positiveCount = 0;
            var negativeCount = 0;
            var processedIndices = new Set();
            
            // First pass: identify all emotion words and their positions
            for (var i = 0; i < tokens.length; i++) {
                var token = tokens[i];
                var word = token.word;
                var surface = token.surface;
                
                if (lexicon[word]) {
                    emotionWordIndices.push({ index: i, word: word, surface: surface });
                } else if (!useKuromoji) {
                    // Try partial matching for simple tokenizer
                    for (var len = word.length - 1; len >= 2; len--) {
                        var baseWord = word.substring(0, len);
                        if (lexicon[baseWord]) {
                            emotionWordIndices.push({ index: i, word: baseWord, surface: surface });
                            break;
                        }
                    }
                }
            }
            
            // Create a set of emotion word indices for quick lookup
            var emotionIndicesSet = new Set();
            for (var i = 0; i < emotionWordIndices.length; i++) {
                emotionIndicesSet.add(emotionWordIndices[i].index);
            }
            
            // Second pass: identify all negations and special negative patterns
            var negationIndices = [];
            var potentialNegations = []; // Store potential negation patterns with type
            
            for (var i = 0; i < tokens.length; i++) {
                var word = tokens[i].word;
                var surface = tokens[i].surface;
                
                // Check both basic form (word) and surface form
                if (NEGATION_WORDS.indexOf(word) !== -1 || NEGATION_WORDS.indexOf(surface) !== -1) {
                    negationIndices.push(i);
                    potentialNegations.push({ index: i, type: 'standard', range: 8 });
                } else if (/ない$/.test(surface) || /ません$/.test(surface) || /ぬ$/.test(surface)) {
                    // Also catch any surface form ending in negation patterns
                    negationIndices.push(i);
                    
                    // Special handling for potential verb negations like できない, られない
                    if (/^(でき|られ|み|え)/.test(surface)) {
                        potentialNegations.push({ index: i, type: 'potential', range: 6 });
                    } else {
                        potentialNegations.push({ index: i, type: 'standard', range: 8 });
                    }
                }
                
                // Special case: Check for "でき" followed by "ない" in next token
                if (i + 1 < tokens.length && 
                    (word === 'でき' || surface === 'でき') && 
                    (/ない/.test(tokens[i + 1].surface) || tokens[i + 1].word === 'ない')) {
                    if (negationIndices.indexOf(i + 1) === -1) {
                        negationIndices.push(i + 1);
                        potentialNegations.push({ index: i + 1, type: 'potential', range: 6 });
                    }
                }
            }
            
            // Third pass: process emotion words with negation context
            for (var i = 0; i < emotionWordIndices.length; i++) {
                var emotionData = emotionWordIndices[i];
                var idx = emotionData.index;
                
                if (processedIndices.has(idx)) continue;
                
                var score = lexicon[emotionData.word].score;
                var isNegated = false;
                var relatedNegationIndex = -1;
                
                if (useBackwardNegation) {
                    // Check each potential negation
                    for (var n = 0; n < potentialNegations.length; n++) {
                        var negation = potentialNegations[n];
                        var negIdx = negation.index;
                        var searchRange = negation.range;
                        
                        // Check if this negation is within range AFTER this emotion word
                        if (negIdx > idx && negIdx - idx <= searchRange) {
                            var validPath = true;
                            var hasParallelPattern = false;
                            
                            // For potential negations (できない, られない), be more lenient
                            if (negation.type === 'potential') {
                                // Check path between emotion word and negation
                                for (var between = idx + 1; between < negIdx; between++) {
                                    var betweenWord = tokens[between].word;
                                    var betweenSurface = tokens[between].surface;
                                    
                                    // Check if this is a parallel particle
                                    if (PARALLEL_PARTICLES.indexOf(betweenWord) !== -1 || NEGATION_PARTICLES.indexOf(betweenWord) !== -1) {
                                        hasParallelPattern = true;
                                        continue;
                                    }
                                    
                                    // Allow emotion words in between (for parallel negation)
                                    if (emotionIndicesSet.has(between)) {
                                        continue;
                                    }
                                    
                                    // For potential negations, be very lenient - allow almost anything except strong breaks
                                    if (!/^(は|が|を|に|で|と|も|や|の|へ|から|まで|より|くは|では|じゃ|でき|き|られ|れ|せ|さ|し|く|て|た|だ|です|ます|たい|たく|よう|ず|ば|なら)$/.test(betweenWord) &&
                                        !/^(は|が|を|に|で|と|も|や|の|へ|から|まで|より|くは|では|じゃ|でき|き|られ|れ|せ|さ|し|く|て|た|だ|です|ます|たい|たく|よう|ず|ば|なら)$/.test(betweenSurface)) {
                                        validPath = false;
                                        break;
                                    }
                                }
                            } else {
                                // Standard negation - use stricter rules
                                for (var between = idx + 1; between < negIdx; between++) {
                                    var betweenWord = tokens[between].word;
                                    
                                    // Check if this is a parallel particle
                                    if (PARALLEL_PARTICLES.indexOf(betweenWord) !== -1 || NEGATION_PARTICLES.indexOf(betweenWord) !== -1) {
                                        hasParallelPattern = true;
                                        continue;
                                    }
                                    
                                    // Allow emotion words in between (for parallel negation)
                                    if (emotionIndicesSet.has(between)) {
                                        continue;
                                    }
                                    
                                    // Allow particles, auxiliaries, and common verb components
                                    if (!/^(は|が|を|に|で|と|も|や|の|へ|から|まで|より|くは|では|じゃ|でき|き|られ|れ|せ|さ|し|く|て|た|だ|です|ます|たい|たく|よう)$/.test(betweenWord)) {
                                        validPath = false;
                                        break;
                                    }
                                }
                            }
                            
                            if (validPath) {
                                isNegated = true;
                                relatedNegationIndex = negIdx;
                                break;
                            }
                        }
                    }
                }
                
                if (isNegated) {
                    score = -score;
                    matchedWords.push({ word: emotionData.word, surface: emotionData.surface, type: 'negated', score: score });
                } else {
                    matchedWords.push({ word: emotionData.word, surface: emotionData.surface, type: 'normal', score: score });
                }
                
                totalScore += score;
                matchCount++;
                if (score > 0) positiveCount++;
                else if (score < 0) negativeCount++;
                processedIndices.add(idx);
            }
            
            // Add negation words to matched words for display
            for (var i = 0; i < negationIndices.length; i++) {
                var negIdx = negationIndices[i];
                matchedWords.push({ 
                    word: tokens[negIdx].word, 
                    surface: tokens[negIdx].surface, 
                    type: 'negation', 
                    score: 0 
                });
            }
            
            var averageScore = matchCount > 0 ? totalScore / matchCount : 0;
            
            return {
                score: averageScore,
                totalScore: totalScore,
                matchCount: matchCount,
                positiveCount: positiveCount,
                negativeCount: negativeCount,
                matchedWords: matchedWords
            };
        }
        
        function findParallelNegation(tokens, negationIndex, emotionWordIndices, processedIndices) {
            var negatedWords = [];
            var searchStart = Math.max(0, negationIndex - 15); // Extended search range
            
            // Work backwards from the negation word
            for (var i = negationIndex - 1; i >= searchStart; i--) {
                var token = tokens[i];
                var word = token.word;
                
                // Check if this position has an emotion word
                var isEmotionWord = false;
                var emotionWordData = null;
                for (var j = 0; j < emotionWordIndices.length; j++) {
                    if (emotionWordIndices[j].index === i && !processedIndices.has(i)) {
                        isEmotionWord = true;
                        emotionWordData = emotionWordIndices[j];
                        break;
                    }
                }
                
                if (isEmotionWord) {
                    // Check if there's a parallel particle or negation particle after this emotion word
                    var hasRelevantParticle = false;
                    if (i + 1 < negationIndex) {
                        var nextWord = tokens[i + 1].word;
                        if (PARALLEL_PARTICLES.indexOf(nextWord) !== -1 || NEGATION_PARTICLES.indexOf(nextWord) !== -1) {
                            hasRelevantParticle = true;
                        }
                    }
                    
                    // Add this emotion word if:
                    // 1. It has a relevant particle after it, OR
                    // 2. We've already found other emotion words (continuing the parallel pattern)
                    if (hasRelevantParticle || negatedWords.length > 0) {
                        negatedWords.push(emotionWordData);
                    } else {
                        // If this emotion word doesn't have a parallel particle and no other words found,
                        // it might still be negated if it's close enough (within 3 tokens)
                        if (negationIndex - i <= 3) {
                            // Check if there's only particles/auxiliaries between
                            var onlyParticlesBetween = true;
                            for (var between = i + 1; between < negationIndex; between++) {
                                var betweenWord = tokens[between].word;
                                if (!/^(は|が|を|に|で|と|も|や|の|へ|から|まで|より|くは|では|じゃ|でき|られ|せ|し)$/.test(betweenWord)) {
                                    onlyParticlesBetween = false;
                                    break;
                                }
                            }
                            if (onlyParticlesBetween) {
                                negatedWords.push(emotionWordData);
                            }
                        }
                        // Stop searching backward if we found an emotion word without parallel pattern
                        break;
                    }
                } else {
                    // If we encounter a non-emotion, non-particle word and have already found emotion words, stop
                    if (PARALLEL_PARTICLES.indexOf(word) === -1 && 
                        NEGATION_PARTICLES.indexOf(word) === -1 && 
                        !/^(でき|られ|せ|し|く)$/.test(word)) {
                        if (negatedWords.length > 0) {
                            break;
                        }
                    }
                }
            }
            
            return negatedWords;
        }
        
        function analyzeText(text) {
            var useKuromoji = useKuromojiToggle.checked && tokenizerReady;
            var useBackwardNegation = backwardNegationToggle.checked;
            
            var sentences = splitIntoSentences(text);
            var sentenceResults = [];
            
            var overallTotalScore = 0;
            var overallMatchCount = 0;
            var overallPositiveCount = 0;
            var overallNegativeCount = 0;
            var allMatchedWords = [];
            
            for (var i = 0; i < sentences.length; i++) {
                var sentence = sentences[i];
                var result = analyzeSingleSentence(sentence, useKuromoji, useBackwardNegation);
                sentenceResults.push({
                    text: sentence,
                    score: result.score,
                    totalScore: result.totalScore,
                    matchCount: result.matchCount,
                    positiveCount: result.positiveCount,
                    negativeCount: result.negativeCount,
                    matchedWords: result.matchedWords
                });
                
                overallTotalScore += result.totalScore;
                overallMatchCount += result.matchCount;
                overallPositiveCount += result.positiveCount;
                overallNegativeCount += result.negativeCount;
                allMatchedWords = allMatchedWords.concat(result.matchedWords);
            }
            
            var overallScore = overallMatchCount > 0 ? overallTotalScore / overallMatchCount : 0;
            
            return {
                score: overallScore,
                totalScore: overallTotalScore,
                matchCount: overallMatchCount,
                positiveCount: overallPositiveCount,
                negativeCount: overallNegativeCount,
                matchedWords: allMatchedWords,
                method: useKuromoji ? 'Kuromoji' : 'Simple',
                backwardNegation: useBackwardNegation,
                sentences: sentenceResults
            };
        }
        
        function displayResult(result, originalText) {
            resultContainer.classList.remove('hidden');
            
            var score = result.score;
            var label = getSentimentLabel(score);
            var meterPosition = ((score + 1) / 2) * 100;
            var meterColor = score > 0.05 ? '#48bb78' : (score < -0.05 ? '#fc8181' : '#718096');
            
            var highlightedText = highlightWords(originalText, result.matchedWords);
            
            var analyzeArray = result.sentences.map(function(s) {
                return s.score;
            });
            var countPolarityArray = result.sentences.map(function(s) {
                return {
                    positive: s.positiveCount,
                    negative: s.negativeCount
                };
            });
            var analyzeDetailArray = result.sentences.map(function(s) {
                return {
                    positive: s.matchedWords.filter(function(w) {
                        return w.type !== 'negation' && w.score > 0;
                    }).map(function(w) {
                        return w.type === 'negated' ? w.word + '-NEGATION' : w.word;
                    }),
                    negative: s.matchedWords.filter(function(w) {
                        return w.type !== 'negation' && w.score < 0;
                    }).map(function(w) {
                        return w.type === 'negated' ? w.word + '-NEGATION' : w.word;
                    }),
                    score: s.score
                };
            });
            
            var researchOutputHtml = '';
            if (result.sentences.length > 0) {
                var methodNote = result.backwardNegation ? 
                    '<div style="color: #fbbf24; margin-bottom: 10px; font-size: 12px;">⚠️ 後方否定・並列否定検出(拡張機能)を使用</div>' : 
                    '<div style="color: #48bb78; margin-bottom: 10px; font-size: 12px;">✓ 元のosetiと同じ前方否定のみ</div>';
                
                researchOutputHtml = '<h3>🔬 研究用データ出力 (Pythonライブラリ互換形式):</h3><div style="background-color: #2d3748; color: #e2e8f0; border-radius: 8px; padding: 20px; margin-top: 15px; font-family: \'Courier New\', monospace; font-size: 14px;">' + methodNote + '<div style="margin-bottom: 15px;"><div style="color: #a0aec0; margin-bottom: 5px;"># analyzer.analyze() 形式:</div><div style="color: #48bb78;">[' + analyzeArray.map(function(s) { return s.toFixed(10); }).join(', ') + ']</div></div><div style="margin-bottom: 15px;"><div style="color: #a0aec0; margin-bottom: 5px;"># analyzer.count_polarity() 形式:</div><div style="color: #48bb78;">' + JSON.stringify(countPolarityArray, null, 2) + '</div></div><div><div style="color: #a0aec0; margin-bottom: 5px;"># analyzer.analyze_detail() 形式:</div><div style="color: #48bb78;">' + JSON.stringify(analyzeDetailArray, null, 2) + '</div></div><button onclick="copyResearchData()" style="margin-top: 15px; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); padding: 8px 16px; font-size: 13px;">📋 コピー</button></div>';
            }
            
            var sentenceAnalysisHtml = '';
            if (result.sentences && result.sentences.length > 1) {
                var methodLabel = result.method + (result.backwardNegation ? ' + 後方・並列否定' : '');
                sentenceAnalysisHtml = '<h3>📝 文ごとの分析結果 (' + methodLabel + '分析):</h3><div style="background-color: #f8fafc; border-radius: 8px; padding: 20px; margin-top: 15px;">';
                
                for (var i = 0; i < result.sentences.length; i++) {
                    var sent = result.sentences[i];
                    var sentScore = sent.score;
                    var sentLabel = getSentimentLabel(sentScore);
                    var sentColor = sentScore > 0.05 ? '#48bb78' : (sentScore < -0.05 ? '#fc8181' : '#718096');
                    var sentHighlighted = highlightWords(sent.text, sent.matchedWords);
                    
                    sentenceAnalysisHtml += '<div class="sentence-box"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><span style="font-weight: 600; color: #4a5568;">第' + (i + 1) + '文:</span><div style="display: flex; align-items: center; gap: 10px;"><span style="font-size: 12px; padding: 4px 10px; border-radius: 12px; background-color: ' + sentColor + '20; color: ' + sentColor + '; font-weight: 600;">' + sentLabel + '</span><span style="font-size: 20px; font-weight: bold; color: ' + sentColor + ';">' + sentScore.toFixed(3) + '</span></div></div><div style="line-height: 1.8; font-size: 16px; margin-bottom: 10px;">' + sentHighlighted + '</div><div style="display: flex; gap: 15px; font-size: 13px; color: #718096;"><span>検出: ' + sent.matchCount + '語</span><span style="color: #48bb78;">ポジ: ' + sent.positiveCount + '</span><span style="color: #fc8181;">ネガ: ' + sent.negativeCount + '</span></div></div>';
                }
                
                sentenceAnalysisHtml += '</div>';
            }
            
            var detectedWordsHtml = '';
            if (result.matchedWords.length > 0) {
                detectedWordsHtml = '<h3>検出された感情語 (全体):</h3><div class="word-list" style="max-height: 300px;">';
                for (var i = 0; i < result.matchedWords.length; i++) {
                    var item = result.matchedWords[i];
                    if (item.type === 'negation') {
                        detectedWordsHtml += '<div class="word-item"><span><strong>' + item.word + '</strong> <span style="color: #718096; font-size: 13px;">(' + item.surface + ')</span></span><span class="score-badge" style="background-color: #fbbf24;">否定語</span></div>';
                    } else {
                        var color = item.score > 0 ? '#48bb78' : '#fc8181';
                        detectedWordsHtml += '<div class="word-item"><span><strong>' + item.word + '</strong> <span style="color: #718096; font-size: 13px;">(' + item.surface + ')</span></span><span class="score-badge" style="background-color: ' + color + ';">' + (item.score > 0 ? '+' : '') + item.score.toFixed(2) + (item.type === 'negated' ? ' (否定)' : '') + '</span></div>';
                    }
                }
                detectedWordsHtml += '</div>';
            } else {
                detectedWordsHtml = '<p style="color: #718096; text-align: center; padding: 20px;">辞書に登録された感情語が見つかりませんでした。</p>';
            }
            
            resultContainer.innerHTML = '<h2 style="text-align: center; margin-bottom: 30px;">📊 分析結果<br><span style="font-size: 18px; font-weight: normal; color: #718096;">Analysis Results</span></h2><div style="text-align: center; margin-bottom: 20px;"><span style="font-size: 14px; color: #718096; display: block; margin-bottom: 5px;">全体の感情スコア<br><span style="font-size: 12px;">Overall Sentiment Score</span></span><span class="sentiment-label" style="background-color: ' + meterColor + ';">' + label + '</span><div style="font-size: 48px; font-weight: bold; color: ' + meterColor + '; margin-top: 15px;">' + score.toFixed(3) + '</div></div><div class="sentiment-meter"><div class="sentiment-indicator" style="left: ' + meterPosition + '%;"></div></div><div class="sentiment-scale"><span style="color: #fc8181;">ネガティブ (-1.0)</span><span style="color: #718096;">中立 (0.0)</span><span style="color: #48bb78;">ポジティブ (1.0)</span></div><div class="stats-grid"><div class="stat-box"><p>検出単語数<br><span style="font-size: 11px; color: #a0aec0;">Detected</span></p><p style="color: #667eea;">' + result.matchCount + '</p></div><div class="stat-box"><p>ポジティブ<br><span style="font-size: 11px; color: #a0aec0;">Positive</span></p><p style="color: #48bb78;">' + result.positiveCount + '</p></div><div class="stat-box"><p>ネガティブ<br><span style="font-size: 11px; color: #a0aec0;">Negative</span></p><p style="color: #fc8181;">' + result.negativeCount + '</p></div><div class="stat-box"><p>合計スコア<br><span style="font-size: 11px; color: #a0aec0;">Total Score</span></p><p style="color: #667eea;">' + (result.totalScore > 0 ? '+' : '') + result.totalScore.toFixed(2) + '</p></div></div>' + researchOutputHtml + sentenceAnalysisHtml + '<h3>テキスト全体のハイライト:</h3><div class="highlight-container">' + highlightedText + '</div>' + detectedWordsHtml;
            
            window.copyResearchData = function() {
                var text = '# analyzer.analyze() 形式:\n[' + analyzeArray.map(function(s) { return s.toFixed(10); }).join(', ') + ']\n\n# analyzer.count_polarity() 形式:\n' + JSON.stringify(countPolarityArray, null, 2) + '\n\n# analyzer.analyze_detail() 形式:\n' + JSON.stringify(analyzeDetailArray, null, 2);
                
                navigator.clipboard.writeText(text).then(function() {
                    showNotification('研究用データをクリップボードにコピーしました!', 'success');
                });
            };
            
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        function getSentimentLabel(score) {
            if (score >= 0.5) return '😄 強いポジティブ';
            if (score >= 0.05) return '🙂 弱いポジティブ';
            if (score > -0.05) return '😐 中立';
            if (score > -0.5) return '🙁 弱いネガティブ';
            return '😢 強いネガティブ';
        }
        
        function highlightWords(text, matchedWords) {
            var highlightedText = text;
            
            var sortedWords = matchedWords.slice().sort(function(a, b) {
                return b.surface.length - a.surface.length;
            });
            
            for (var i = 0; i < sortedWords.length; i++) {
                var item = sortedWords[i];
                if (item.type === 'negation') {
                    var regex = new RegExp(escapeRegex(item.surface), 'g');
                    highlightedText = highlightedText.replace(regex, '<span class="highlight-word" style="background-color: #fbbf24; color: white;">' + item.surface + '</span>');
                } else {
                    var color = item.score > 0 ? '#48bb78' : '#fc8181';
                    var regex2 = new RegExp(escapeRegex(item.surface), 'g');
                    highlightedText = highlightedText.replace(regex2, '<span class="highlight-word" style="background-color: ' + color + '; color: white;" title="基本形: ' + item.word + ' | スコア: ' + item.score.toFixed(2) + '">' + item.surface + '</span>');
                }
            }
            
            return highlightedText;
        }
        
        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        function showNotification(message, type) {
            var existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(function(n) {
                n.remove();
            });
            
            var notification = document.createElement('div');
            notification.className = 'notification ' + type;
            notification.textContent = message;
            
            var container = document.querySelector('.container');
            container.insertBefore(notification, container.firstChild);
            
            setTimeout(function() {
                notification.remove();
            }, 5000);
        }
        
        document.querySelectorAll('.tab[data-tab]').forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab[data-tab]').forEach(function(t) {
                    t.classList.remove('active');
                });
                tab.classList.add('active');
                
                var tabName = tab.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(function(content) {
                    content.classList.remove('active');
                });
                document.getElementById(tabName + '-tab').classList.add('active');
            });
        });
        
        document.querySelectorAll('.sample-btn').forEach(function(button) {
            button.addEventListener('click', function() {
                textInput.value = button.textContent;
                analyzeBtn.click();
            });
        });
        
        function toggleCredits() {
            var content = document.getElementById('credit-content');
            var arrow = document.getElementById('credit-arrow');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                setTimeout(function() {
                    content.classList.add('show');
                }, 10);
                arrow.style.transform = 'rotate(180deg)';
            } else {
                content.classList.remove('show');
                setTimeout(function() {
                    content.classList.add('hidden');
                }, 300);
                arrow.style.transform = 'rotate(0deg)';
            }
        }
    </script>
</body>
</html>